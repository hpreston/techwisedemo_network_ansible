# This example ensures the correct SVIs are configured on every switch
---

- name: Setup VLAN Interfaces on Distribution Switches
  hosts: distribution
  connection: local
  tasks: 
    - name: Create SVI Interface 
      with_items: 
        - interface: Vlan3001
        - interface: Vlan3002
      nxos_config: 
        host: "{{ inventory_hostname }}"
        transport: nxapi 
        lines: 
          - "interface {{ item.interface }}"
        save: yes
    - name: Configure IPv4 Address on SVI
      with_items: 
        - interface: vlan3001
          name: ANSIBLE1
          prefix: 10.30.01.
          gw_mask: 24
        - interface: vlan3002
          name: ANSIBLE2
          prefix: 10.30.02.
          gw_mask: 24
      nxos_ip_interface:
        host: "{{ inventory_hostname }}"
        state: present
        transport: nxapi
        interface: "{{ item.interface }} "
        addr: "{{ item.prefix }}{{svi_octet}}"
        mask: "{{ item.gw_mask }}"  
    - name: Enable HSRP Feature
      nxos_feature: 
        host: "{{ inventory_hostname }}"
        state: present 
        transport: nxapi
        feature: hsrp
        state: enabled
    - name: Setup HSRP on SVI
      with_items: 
        - interface: vlan3001
          name: ANSIBLE1
          gw_addr: 10.30.01.1
        - interface: vlan3002
          name: ANSIBLE2
          gw_addr: 10.30.02.1
      nxos_hsrp: 
        host: "{{ inventory_hostname }}"
        state: present 
        transport: nxapi
        interface: "{{ item.interface }}"
        group: 10
        vip: "{{ item.gw_addr }}"

